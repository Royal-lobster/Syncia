var u=typeof globalThis.process<"u"?globalThis.process.argv:[];var h=()=>typeof globalThis.process<"u"?globalThis.process.env:{};var B=new Set(u),_=e=>B.has(e),G=u.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[t,o])=>(e[t]=o,e),{});var U=_("--dry-run"),g=()=>_("--verbose")||h().VERBOSE==="true",N=g();var m=(e="",...t)=>console.log(e.padEnd(9),"|",...t);var y=(...e)=>console.error("\u{1F534} ERROR".padEnd(9),"|",...e),b=(...e)=>m("\u{1F535} INFO",...e),f=(...e)=>m("\u{1F7E0} WARN",...e),M=0,i=(...e)=>g()&&m(`\u{1F7E1} ${M++}`,...e);var v=()=>{let e=globalThis.browser?.runtime||globalThis.chrome?.runtime,t=()=>setInterval(e.getPlatformInfo,24e3);e.onStartup.addListener(t),t()};var n=__plasmo_runtime_data__;module.bundle.HMR_BUNDLE_ID=n.bundleId;globalThis.process={argv:[],env:{VERBOSE:n.verbose}};var D=module.bundle.Module;function H(e){D.call(this,e),this.hot={data:module.bundle.hotData[e],_acceptCallbacks:[],_disposeCallbacks:[],accept:function(t){this._acceptCallbacks.push(t||function(){})},dispose:function(t){this._disposeCallbacks.push(t)}},module.bundle.hotData[e]=void 0}module.bundle.Module=H;module.bundle.hotData={};var c=globalThis.browser||globalThis.chrome||null;function R(){return!n.host||n.host==="0.0.0.0"?location.protocol.indexOf("http")===0?location.hostname:"localhost":n.host}function x(){return!n.host||n.host==="0.0.0.0"?"localhost":n.host}function d(){return n.port||location.port}var P="__plasmo_runtime_page_",S="__plasmo_runtime_script_";var O=`${n.secure?"https":"http"}://${R()}:${d()}/`;async function k(e=1470){for(;;)try{await fetch(O);break}catch{await new Promise(o=>setTimeout(o,e))}}if(c.runtime.getManifest().manifest_version===3){let e=c.runtime.getURL("/__plasmo_hmr_proxy__?url=");globalThis.addEventListener("fetch",function(t){let o=t.request.url;if(o.startsWith(e)){let s=new URL(decodeURIComponent(o.slice(e.length)));s.hostname===n.host&&s.port===`${n.port}`?(s.searchParams.set("t",Date.now().toString()),t.respondWith(fetch(s).then(r=>new Response(r.body,{headers:{"Content-Type":r.headers.get("Content-Type")??"text/javascript"}})))):t.respondWith(new Response("Plasmo HMR",{status:200,statusText:"Testing"}))}})}function E(e,t){let{modules:o}=e;return o?!!o[t]:!1}function C(e=d()){let t=x();return`${n.secure||location.protocol==="https:"&&!/localhost|127.0.0.1|0.0.0.0/.test(t)?"wss":"ws"}://${t}:${e}/`}function T(e){typeof e.message=="string"&&y("[plasmo/parcel-runtime]: "+e.message)}function L(e){if(typeof globalThis.WebSocket>"u")return;let t=new WebSocket(C(Number(d())+1));return t.addEventListener("message",async function(o){let s=JSON.parse(o.data);await e(s)}),t.addEventListener("error",T),t}function A(e){if(typeof globalThis.WebSocket>"u")return;let t=new WebSocket(C());return t.addEventListener("message",async function(o){let s=JSON.parse(o.data);if(s.type==="update"&&await e(s.assets),s.type==="error")for(let r of s.diagnostics.ansi){let l=r.codeframe||r.stack;f("[plasmo/parcel-runtime]: "+r.message+`
`+l+`

`+r.hints.join(`
`))}}),t.addEventListener("error",T),t.addEventListener("open",()=>{b(`[plasmo/parcel-runtime]: Connected to HMR server for ${n.entryFilePath}`)}),t.addEventListener("close",()=>{f(`[plasmo/parcel-runtime]: Connection to the HMR server is closed for ${n.entryFilePath}`)}),t}var w=module.bundle.parent,a={buildReady:!1,bgChanged:!1,csChanged:!1,pageChanged:!1,scriptPorts:new Set,pagePorts:new Set};async function p(e=!1){if(e||a.buildReady&&a.pageChanged){i("BGSW Runtime - reloading Page");for(let t of a.pagePorts)t.postMessage(null)}if(e||a.buildReady&&(a.bgChanged||a.csChanged)){i("BGSW Runtime - reloading CS");let t=await c?.tabs.query({active:!0});for(let o of a.scriptPorts){let s=t.some(r=>r.id===o.sender.tab?.id);o.postMessage({__plasmo_cs_active_tab__:s})}c.runtime.reload()}}if(!w||!w.isParcelRequire){v();let e=A(async t=>{i("BGSW Runtime - On HMR Update"),a.bgChanged||=t.filter(s=>s.envHash===n.envHash).some(s=>E(module.bundle,s.id));let o=t.find(s=>s.type==="json");if(o){let s=new Set(t.map(l=>l.id)),r=Object.values(o.depsByBundle).map(l=>Object.values(l)).flat();a.bgChanged||=r.every(l=>s.has(l))}p()});e.addEventListener("open",()=>{let t=setInterval(()=>e.send("ping"),24e3);e.addEventListener("close",()=>clearInterval(t))}),e.addEventListener("close",async()=>{await k(),p(!0)})}L(async e=>{switch(i("BGSW Runtime - On Build Repackaged"),e.type){case"build_ready":{a.buildReady||=!0,p();break}case"cs_changed":{a.csChanged||=!0,p();break}}});c.runtime.onConnect.addListener(function(e){let t=e.name.startsWith(P),o=e.name.startsWith(S);if(t||o){let s=t?a.pagePorts:a.scriptPorts;s.add(e),e.onDisconnect.addListener(()=>{s.delete(e)}),e.onMessage.addListener(function(r){i("BGSW Runtime - On source changed",r),r.__plasmo_cs_changed__&&(a.csChanged||=!0),r.__plasmo_page_changed__&&(a.pageChanged||=!0),p()})}});c.runtime.onMessage.addListener(function(t){return t.__plasmo_full_reload__&&(i("BGSW Runtime - On top-level code changed"),p()),!0});
